# ==============================================================================
# Famli - Configuração do Render (Infrastructure as Code)
# ==============================================================================
# Este arquivo permite configurar o deploy automaticamente no Render.
#
# Para usar:
#   1. Vá em https://dashboard.render.com/
#   2. Clique em "New" > "Blueprint"
#   3. Conecte seu repositório
#   4. O Render detectará este arquivo automaticamente
#
# Documentação: https://render.com/docs/blueprint-spec
# ==============================================================================

version: "1"

projects:
  - name: Famli
    environments:
      - name: Production
        # ======================================================================
        # DATABASES
        # ======================================================================
        databases:
          - name: famli
            databaseName: famli
            user: famli
            plan: free
            region: oregon
            ipAllowList:
              - source: 0.0.0.0/0
                description: everywhere
            postgresMajorVersion: "16"

        # ======================================================================
        # SERVICES
        # ======================================================================
        services:
          - type: web
            name: famli
            runtime: go
            repo: https://github.com/seimongrando/famli
            plan: free
            region: oregon
            buildCommand: cd frontend && npm ci && npm run build && cd ../backend && go build -ldflags="-s -w" -o ../server .
            startCommand: STATIC_DIR=./frontend/dist ./server
            autoDeployTrigger: commit
            envVars:
              - key: DATABASE_URL
                fromDatabase:
                  name: famli
                  property: connectionString
              - key: ENV
                value: production
              - key: JWT_SECRET
                sync: false
              - key: ENCRYPTION_KEY
                sync: false
              - key: ADMIN_EMAILS
                sync: false
