# ==============================================================================
# Famli - Configuração do Render (Infrastructure as Code)
# ==============================================================================
# Este arquivo permite configurar o deploy automaticamente no Render.
#
# Para usar:
#   1. Vá em https://dashboard.render.com/
#   2. Clique em "New" > "Blueprint"
#   3. Conecte seu repositório
#   4. O Render detectará este arquivo automaticamente
#
# Documentação: https://render.com/docs/blueprint-spec
# ==============================================================================

version: "1"
projects:
  - name: Famli
    environments:
      - name: Production
    # ==============================================================================
    # DATABASES
    # ==============================================================================
    databases:
      - name: famli
        databaseName: famli
        user: famli
        plan: free
        region: oregon
        ipAllowList:
          - source: 0.0.0.0/0
            description: everywhere
        postgresMajorVersion: "18"

    # ==============================================================================
    # SERVICES
    # ==============================================================================
    services:
      # ============================================================================
      # FAMLI - Web Service
      # ============================================================================
      - type: web
        name: famli
        runtime: go
        repo: https://github.com/seimongrando/famli
        plan: free
        region: oregon

        # Comandos de build e start
        buildCommand: cd frontend && npm ci && npm run build && cd ../backend && go build -ldflags="-s -w" -o ../server .
        startCommand: STATIC_DIR=./frontend/dist ./server

        # Deploy automático em cada commit
        autoDeployTrigger: commit

        # Variáveis de ambiente
        envVars:
          # Banco de dados (referência ao database criado acima)
          - key: DATABASE_URL
            fromDatabase:
              name: famli
              property: connectionString

          # Ambiente
          - key: ENV
            value: production

          # Segredos (configurar manualmente no dashboard)
          - key: JWT_SECRET
            sync: false

          - key: ENCRYPTION_KEY
            sync: false

          # Administradores (configurar manualmente)
          - key: ADMIN_EMAILS
            sync: false
