<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Famli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <!-- Vue 3 via CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body>
<div id="app">
  <!-- VIEW: LANDING (p√∫blica) -->
  <div v-if="view === 'landing'" class="landing-wrapper">
    <header class="landing-header">
      <div class="brand brand-row">
        <img src="./famli.png" alt="Famli" class="brand-logo-img" />
        <span class="brand-text">famli</span>
      </div>
      <nav class="landing-nav">
        <button class="ghost" @click="goToAuth('login')">Entrar</button>
        <button class="primary" @click="goToAuth('register')">Criar conta</button>
      </nav>
    </header>

    <main class="landing-main">
      <section class="hero">
        <div class="hero-text">
          <h1>Guarde o que importa hoje.<br />Deixe tranquilo quem voc√™ ama amanh√£.</h1>
          <p>
            Um espa√ßo seguro e simples para organizar documentos, instru√ß√µes e mem√≥rias,
            feito para quem j√° viveu muita coisa.
          </p>
          <div class="hero-actions">
            <button class="primary big" @click="goToAuth('register')">
              Come√ßar agora
            </button>
            <button class="ghost big" @click="goToAuth('login')">
              J√° tenho conta
            </button>
          </div>
        </div>
        <div class="hero-card">
          <p class="hero-card-title">Seu cuidado em um s√≥ lugar</p>
          <ul>
            <li>Informa√ß√µes importantes com instru√ß√µes claras</li>
            <li>Pessoas de confian√ßa escolhidas por voc√™</li>
            <li>Mem√≥rias e mensagens para quem voc√™ ama</li>
          </ul>
        </div>
      </section>

      <section class="landing-section">
        <h2>Para quem √© o Famli?</h2>
        <div class="landing-columns">
          <div class="landing-card">
            <h3>Para quem tem 50+</h3>
            <p>Quer deixar tudo organizado, sem depender da mem√≥ria para lembrar de tudo.</p>
          </div>
          <div class="landing-card">
            <h3>Para fam√≠lias</h3>
            <p>Que n√£o querem deixar ningu√©m no escuro em caso de emerg√™ncia.</p>
          </div>
          <div class="landing-card">
            <h3>Para quem cuida</h3>
            <p>Filhos, netos e pessoas de confian√ßa que precisam saber onde encontrar o que √© importante.</p>
          </div>
        </div>
      </section>

      <section class="landing-section">
        <h2>O que voc√™ pode guardar</h2>
        <div class="landing-columns">
          <div class="landing-card">
            <h3>Informa√ß√µes importantes</h3>
            <p>Planos de sa√∫de, seguros, contas, im√≥veis e contatos de emerg√™ncia com instru√ß√µes de uso.</p>
          </div>
          <div class="landing-card">
            <h3>Senhas e acessos (como instru√ß√µes)</h3>
            <p>
              Aqui voc√™ explica <strong>onde</strong> est√£o suas senhas e como acessar
              (por exemplo: ‚Äútodas as minhas senhas ficam no aplicativo X, com o e-mail Y‚Äù).
              As senhas completas podem continuar guardadas em um aplicativo pr√≥prio s√≥ para senhas.
            </p>
          </div>
          <div class="landing-card">
            <h3>Pessoas de confian√ßa</h3>
            <p>
              Familiares ou amigos pr√≥ximos que voc√™ autoriza a serem avisados se um dia
              n√£o puder acessar sua conta.
            </p>
          </div>
          <div class="landing-card">
            <h3>Mem√≥rias e mensagens</h3>
            <p>Recados, hist√≥rias e lembran√ßas para quem √© importante pra voc√™.</p>
          </div>
        </div>
      </section>

      <!-- NOVA SE√á√ÉO: VIS√ÉO PARA PESSOAS DE CONFIAN√áA / CO-AUTOR -->
      <section class="landing-section landing-two-columns">
        <div>
          <h2>Como sua fam√≠lia poder√° ver o que voc√™ deixou</h2>
          <p>
            A ideia do Famli √© que, no futuro, quem voc√™ marcar como pessoa de confian√ßa
            possa ter uma vis√£o especial, em formato de lembran√ßas:
          </p>
          <ul class="bullet-list">
            <li>Somente leitura, sem poder apagar nada.</li>
            <li>Mensagens e hist√≥rias organizadas como um di√°rio.</li>
            <li>Instru√ß√µes importantes separadas por tema (sa√∫de, finan√ßas, fam√≠lia...).</li>
          </ul>
          <p>
            Assim, em vez de planilhas confusas, seus filhos ou netos veem um espa√ßo de
            recorda√ß√µes e orienta√ß√µes feito por voc√™.
          </p>
        </div>
        <div>
          <h2>Co-autor de confian√ßa (ideia em constru√ß√£o)</h2>
          <p>
            Conforme a idade chega, √© comum a gente ir deixando alguns h√°bitos de lado.
            Por isso estamos desenhando a figura de um ‚Äúco-autor de confian√ßa‚Äù:
          </p>
          <ul class="bullet-list">
            <li>Algu√©m pr√≥ximo que pode te ajudar a preencher o Famli.</li>
            <li>Com acesso limitado: pode completar informa√ß√µes, n√£o apagar tudo.</li>
            <li>Sempre com voc√™ no controle do que pode ou n√£o ser feito.</li>
          </ul>
          <p>
            A inten√ß√£o √© que voc√™ n√£o precise cuidar de tudo sozinho, e tenha ajuda
            de quem j√° est√° ao seu lado no dia a dia.
          </p>
        </div>
      </section>

      <section class="landing-section landing-two-columns">
        <div>
          <h2>Seguran√ßa e privacidade em primeiro lugar</h2>
          <ul class="bullet-list">
            <li>Seus dados s√£o protegidos e s√≥ voc√™ decide quem pode ver.</li>
            <li>Voc√™ pode apagar tudo quando quiser.</li>
            <li>N√£o vendemos nem compartilhamos seus dados com terceiros para marketing.</li>
            <li>Adicionar uma pessoa de confian√ßa <strong>n√£o</strong> d√° acesso autom√°tico √†s suas informa√ß√µes.</li>
            <li>Todo acesso √© registrado e voc√™ pode ser avisado em caso de atividade suspeita.</li>
          </ul>
        </div>
        <div>
          <h2>Assistente com IA para ajudar em cada passo</h2>
          <p>
            N√£o √© preciso entender de tecnologia. Voc√™ pode conversar com o assistente Famli
            como faria com algu√©m pr√≥ximo:
          </p>
          <p class="quote">
            ‚ÄúQuero guardar meus documentos do plano de sa√∫de. Por onde come√ßo?‚Äù
          </p>
          <p>
            Ele te guia, passo a passo, dentro da sua Caixa Famli e pode sugerir,
            aos poucos, novas coisas para registrar, sem cobrar que voc√™ fa√ßa tudo de uma vez.
          </p>
        </div>
      </section>

      <section class="landing-section center">
        <h2>Comece hoje a organizar o que √© importante</h2>
        <p>Leva menos de 5 minutos para dar o primeiro passo.</p>
        <button class="primary big" @click="goToAuth('register')">
          Criar minha conta
        </button>
        <button class="link-button" @click="goToAuth('login')">
          Entrar se j√° tenho conta
        </button>
      </section>
    </main>
  </div>

  <!-- VIEW: AUTENTICA√á√ÉO -->
  <div v-else-if="view === 'auth'" class="auth-wrapper">
    <header class="landing-header">
      <div class="brand brand-row">
        <img src="./famli.png" alt="Famli" class="brand-logo-img" />
        <span class="brand-text">famli</span>
      </div>
      <nav class="landing-nav">
        <button class="ghost" @click="goToLanding">Voltar</button>
      </nav>
    </header>

    <main class="auth-main">
      <section class="panel auth-panel">
        <div class="auth-toggle">
          <button
                  :class="['tab', authMode === 'login' ? 'active' : '']"
                  @click="authMode = 'login'">
            Entrar
          </button>
          <button
                  :class="['tab', authMode === 'register' ? 'active' : '']"
                  @click="authMode = 'register'">
            Criar conta
          </button>
        </div>

        <h1 v-if="authMode === 'login'">Bem-vindo de volta ao Famli</h1>
        <h1 v-else>Crie sua conta Famli</h1>

        <form @submit.prevent="handleAuthSubmit">
          <label>
            E-mail
            <input
                    type="email"
                    v-model="authForm.email"
                    required
                    autocomplete="email" />
          </label>
          <label>
            Senha
            <input
                    type="password"
                    v-model="authForm.password"
                    required
                    minlength="6"
                    autocomplete="current-password" />
          </label>
          <p class="auth-hint">
            Use um e-mail que voc√™ acesse com frequ√™ncia.
          </p>
          <button class="primary full" type="submit" :disabled="authLoading">
              <span v-if="authMode === 'login'">
                {{ authLoading ? 'Entrando...' : 'Entrar' }}
              </span>
            <span v-else>
                {{ authLoading ? 'Criando...' : 'Criar conta' }}
              </span>
          </button>
          <p v-if="authError" class="error-text">{{ authError }}</p>
        </form>
      </section>
    </main>
  </div>

  <!-- VIEW: DASHBOARD (logado) -->
  <div v-else-if="view === 'dashboard'" class="dashboard-wrapper">
    <header class="top-bar">
      <div class="brand brand-row">
        <img src="./famli.png" alt="Famli" class="brand-logo-img" />
        <span class="brand-text">famli</span>
      </div>
      <div class="top-bar-center">
        <span class="tagline">Guarde o que importa, com calma.</span>
      </div>
      <div class="top-bar-actions">
        <button class="ghost small" @click="openSettings">
          Configura√ß√µes
        </button>
        <button class="ghost small" @click="logout">
          Sair
        </button>
      </div>
    </header>

    <main class="panel dashboard">
      <div class="dashboard-grid">
        <!-- SIDEBAR ESQUERDA -->
        <aside class="sidebar-left">
          <section class="sidebar-card">
            <h2>Sua conta</h2>
            <p class="user-email">{{ user?.email }}</p>
            <p class="sidebar-text">
              Voc√™ j√° organizou <strong>{{ summaryCounts.total }}</strong> itens na Famli.
            </p>
            <ul class="sidebar-list">
              <li>
                ‚úÖ Guardou sua primeira informa√ß√£o
              </li>
              <li>
                <span v-if="summaryCounts.guardians > 0">‚úÖ</span>
                <span v-else>‚¨ú</span>
                Adicionou uma pessoa de confian√ßa
              </li>
              <li>
                <span v-if="settings.emergency_protocol_enabled">‚úÖ</span>
                <span v-else>‚¨ú</span>
                Ativou o protocolo de emerg√™ncia
              </li>
            </ul>
          </section>

          <section class="sidebar-card">
            <h2>Sobre pessoas de confian√ßa</h2>
            <p class="sidebar-text">
              Pessoas de confian√ßa s√£o familiares ou amigos pr√≥ximos que voc√™ autoriza a serem avisados
              se um dia n√£o puder acessar sua conta.
            </p>
            <p class="sidebar-text">
              Neste momento, elas <strong>n√£o recebem automaticamente</strong> suas informa√ß√µes.
              S√≥ voc√™ v√™ o que est√° na sua Caixa Famli.
            </p>
            <p class="sidebar-text">
              Estamos desenhando, para o futuro, uma vis√£o especial em formato de lembran√ßas
              para essas pessoas, sempre em modo somente leitura e com voc√™ decidindo
              o que cada uma poder√° ver.
            </p>
            <button class="link-button small" @click="showLgpd = true">
              Ver detalhes de privacidade
            </button>
          </section>

          <section class="sidebar-card">
            <h2>Seguran√ßa e LGPD</h2>
            <p class="sidebar-text">
              Seus dados s√£o seus. Voc√™ pode apagar tudo quando quiser.
            </p>
            <button class="link-button small" @click="showLgpd = true">
              Ver transpar√™ncia LGPD
            </button>
          </section>
        </aside>

        <!-- COLUNA CENTRAL (COMPOSER + FEED) -->
        <section class="dashboard-center">
          <!-- COMPOSER -->
          <section class="composer-card">
            <h1>O que voc√™ deseja guardar hoje?</h1>
            <p class="composer-intro">
              Voc√™ pode registrar informa√ß√µes importantes, escolher pessoas de confian√ßa
              e escrever mensagens para quem voc√™ ama.
            </p>
            <div class="composer-types">
              <button
                      :class="['chip', composerType === 'info' ? 'active' : '']"
                      @click="composerType = 'info'">
                Informa√ß√£o importante
              </button>
              <button
                      :class="['chip', composerType === 'guardian' ? 'active' : '']"
                      @click="composerType = 'guardian'">
                Pessoa de confian√ßa
              </button>
              <button
                      :class="['chip', composerType === 'memory' ? 'active' : '']"
                      @click="composerType = 'memory'">
                Mem√≥ria / mensagem
              </button>
            </div>

            <!-- Form INFO -->
            <form
                    v-if="composerType === 'info'"
                    @submit.prevent="saveInfo"
                    class="composer-form">
              <p class="composer-explainer">
                Use este espa√ßo para guardar instru√ß√µes, contatos e orienta√ß√µes importantes.
                Se precisar registrar senhas, use este campo para explicar onde elas est√£o
                e como acessar (por exemplo: aplicativo de senhas, caderno em casa, etc.).
              </p>
              <label>
                T√≠tulo da informa√ß√£o
                <input
                        type="text"
                        v-model="infoForm.title"
                        required
                        placeholder="Ex: Plano de sa√∫de, seguro, conta importante" />
              </label>
              <label>
                Detalhes
                <textarea
                        v-model="infoForm.content"
                        required
                        rows="3"
                        placeholder="Descreva o que √©, onde acessar, contatos, links..."></textarea>
              </label>
              <button class="primary" type="submit" :disabled="savingInfo">
                {{ savingInfo ? 'Salvando...' : 'Guardar informa√ß√£o' }}
              </button>
            </form>

            <!-- Form GUARDIAN -->
            <form
                    v-else-if="composerType === 'guardian'"
                    @submit.prevent="saveGuardian"
                    class="composer-form">
              <p class="composer-explainer">
                Pessoas de confian√ßa s√£o familiares ou amigos que voc√™ autoriza a serem avisados
                se um dia n√£o puder acessar sua conta.
                Neste momento, elas <strong>n√£o t√™m acesso autom√°tico</strong> ao que voc√™ guarda aqui.
              </p>
              <label>
                Nome da pessoa de confian√ßa
                <input
                        type="text"
                        v-model="guardianForm.name"
                        required
                        placeholder="Ex: Ana, Carlos, Jo√£o..." />
              </label>
              <label>
                E-mail
                <input
                        type="email"
                        v-model="guardianForm.email"
                        required
                        placeholder="E-mail de contato dessa pessoa" />
              </label>
              <button class="primary" type="submit" :disabled="savingGuardian">
                {{ savingGuardian ? 'Salvando...' : 'Adicionar pessoa de confian√ßa' }}
              </button>
            </form>

            <!-- Form MEMORY -->
            <form
                    v-else
                    @submit.prevent="saveMemory"
                    class="composer-form">
              <p class="composer-explainer">
                Aqui voc√™ pode escrever recados, hist√≥rias ou mensagens para quem √© importante pra voc√™.
              </p>
              <label>
                T√≠tulo da mem√≥ria ou mensagem
                <input
                        type="text"
                        v-model="memoryForm.title"
                        required
                        placeholder="Ex: Mensagem para meus filhos" />
              </label>
              <label>
                Mensagem
                <textarea
                        v-model="memoryForm.content"
                        required
                        rows="3"
                        placeholder="Escreva sua mensagem ou lembran√ßa."></textarea>
              </label>
              <button class="primary" type="submit" :disabled="savingMemory">
                {{ savingMemory ? 'Salvando...' : 'Guardar mem√≥ria / mensagem' }}
              </button>
            </form>
          </section>

          <!-- FEED: SUA CAIXA FAMLI -->
          <section class="caixa-block">
            <div class="caixa-header">
              <div>
                <h2>Sua Caixa Famli</h2>
                <p>Tudo o que voc√™ j√° guardou, em um s√≥ lugar.</p>
              </div>
              <div class="caixa-summary">
                <span>Informa√ß√µes: {{ summaryCounts.infos }}</span>
                <span>Pessoas: {{ summaryCounts.guardians }}</span>
                <span>Mem√≥rias: {{ summaryCounts.memories }}</span>
              </div>
            </div>

            <!-- FILTROS -->
            <div class="caixa-filters">
              <button
                      :class="['chip', feedFilter === 'all' ? 'active' : '']"
                      @click="feedFilter = 'all'">
                Tudo
              </button>
              <button
                      :class="['chip', feedFilter === 'info' ? 'active' : '']"
                      @click="feedFilter = 'info'">
                Informa√ß√µes
              </button>
              <button
                      :class="['chip', feedFilter === 'guardian' ? 'active' : '']"
                      @click="feedFilter = 'guardian'">
                Pessoas de confian√ßa
              </button>
              <button
                      :class="['chip', feedFilter === 'memory' ? 'active' : '']"
                      @click="feedFilter = 'memory'">
                Mem√≥rias / mensagens
              </button>
            </div>

            <!-- LISTA UNIFICADA -->
            <div v-if="filteredEntries.length === 0" class="empty-state">
              <p>Nenhum item ainda. Comece guardando algo importante no topo da p√°gina.</p>
            </div>
            <ul v-else class="feed-list">
              <li v-for="entry in filteredEntries" :key="entry.kind + '-' + entry.id" class="feed-card">
                <div class="feed-icon">
                  <span v-if="entry.kind === 'info'">üìÑ</span>
                  <span v-else-if="entry.kind === 'guardian'">üë§</span>
                  <span v-else>üí¨</span>
                </div>
                <div class="feed-main">
                  <div class="feed-title-row">
                    <h3>{{ entry.title }}</h3>
                    <span class="feed-type">
                        {{ entry.typeLabel }}
                      </span>
                  </div>
                  <p v-if="entry.description" class="feed-description">
                    {{ entry.description }}
                  </p>
                  <p v-if="formattedEntryDate(entry)" class="feed-meta">
                    Atualizado em {{ formattedEntryDate(entry) }}
                  </p>
                </div>
                <div class="feed-actions">
                  <button class="ghost small" @click="editEntry(entry)">
                    Ver / Editar
                  </button>
                  <button class="ghost small danger" @click="deleteEntry(entry)">
                    Excluir
                  </button>
                </div>
              </li>
            </ul>
          </section>
        </section>

        <!-- SIDEBAR DIREITA ‚Äì ASSISTENTE -->
        <aside class="sidebar-right">
          <section class="assistant">
            <h2>Assistente Famli</h2>
            <p class="assistant-text">
              Converse comigo como faria com algu√©m pr√≥ximo. Posso te ajudar a decidir o que guardar,
              como organizar e como explicar as coisas para suas pessoas de confian√ßa.
            </p>
            <form @submit.prevent="sendAssistant" class="assistant-form">
                <textarea
                        v-model="assistantInput"
                        rows="3"
                        placeholder="Ex: Quero guardar o telefone do meu cardiologista. Como fa√ßo?"></textarea>
              <button class="primary full" type="submit" :disabled="assistantLoading">
                {{ assistantLoading ? 'Pensando...' : 'Enviar' }}
              </button>
            </form>
            <div v-if="assistantReply" class="assistant-reply">
              <p>{{ assistantReply }}</p>
            </div>
          </section>
        </aside>
      </div>
    </main>

    <!-- MODAL LGPD -->
    <div v-if="showLgpd" class="modal-backdrop" @click.self="showLgpd = false">
      <div class="modal">
        <h2>Transpar√™ncia LGPD</h2>
        <p>
          Seus dados s√£o seus. Usamos suas informa√ß√µes apenas para organizar sua
          Caixa Famli e mostrar o que voc√™ guardou para voc√™.
        </p>
        <p>
          Voc√™ pode apagar tudo o que guardou a qualquer momento. N√£o vendemos
          nem compartilhamos seus dados com terceiros para fins de marketing.
        </p>
        <p>
          Adicionar algu√©m como pessoa de confian√ßa <strong>n√£o</strong> d√° acesso autom√°tico
          √†s suas informa√ß√µes. No MVP, elas servem para voc√™ registrar quem s√£o as pessoas
          que poder√£o ser avisadas se um dia precisar de ajuda.
        </p>
        <p>
          Em vers√µes futuras, voc√™ poder√° escolher com mais detalhe:
          quais informa√ß√µes compartilhar, com quem e em quais situa√ß√µes.
        </p>
        <button class="primary full" @click="showLgpd = false">
          Entendi
        </button>
      </div>
    </div>

    <!-- MODAL CONFIGURA√á√ïES (opcional simples) -->
    <div v-if="showSettings" class="modal-backdrop" @click.self="showSettings = false">
      <div class="modal">
        <h2>Configura√ß√µes</h2>
        <label class="toggle-row">
          <input
                  type="checkbox"
                  v-model="settings.emergency_protocol_enabled"
                  @change="saveSettings" />
          <span>Ativar protocolo de emerg√™ncia (conceito)</span>
        </label>
        <p class="hint">
          No futuro, isso permitir√° que suas pessoas de confian√ßa sejam avisadas
          se voc√™ ficar muito tempo sem acessar sua conta. Por enquanto,
          √© apenas uma configura√ß√£o inicial.
        </p>
        <button class="primary full" @click="showSettings = false">
          Fechar
        </button>
      </div>
    </div>
  </div>

  <!-- fallback simples -->
  <div v-else>
    Carregando...
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
